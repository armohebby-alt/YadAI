<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>📚 برنامه‌ریزی هوشمند درسی — نسخه نهایی با هوش مصنوعی آفلاین + آنلاین</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&family=Shabnam:wght@400;700&family=Samim:wght@400;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root {
      --primary-color: #00c3ff;
      --secondary-color: #ff9ff3;
      --bg-dark: #12121e;
      --card-bg: #1e1e2f;
      --text-light: #f0f0f0;
      --text-dark: #1e1e2f;
      --item-bg: #2c2c3c;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
      --radius: 12px;
      --transition: all 0.3s ease-in-out;
      --parent-color: #4CAF50;
      --teacher-color: #FF9800;
      --ai-color: #9C27B0;
      --ai-advanced-color: #FF5722;
      --ai-online-color: #673AB7;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Vazirmatn', sans-serif;
      background: var(--bg-dark);
      color: var(--text-light);
      padding: 1.5rem 1rem;
      line-height: 1.7;
      font-size: 16px;
      transition: var(--transition);
    }

    h1, h2, h3 {
      text-align: center;
      font-weight: 700;
    }

    h1 {
      color: var(--primary-color);
      margin-bottom: 1.5rem;
      font-size: 1.8rem;
    }

    h2 {
      margin: 2rem 0 1rem;
      color: var(--primary-color);
      font-size: 1.4rem;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
    }

    .card {
      background: var(--card-bg);
      color: var(--text-light);
      padding: 1.5rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 1.5rem;
      transition: var(--transition);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .form-group {
      margin-bottom: 1rem;
      text-align: right;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--text-light);
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 0.75rem;
      background: #2c2c3c;
      color: var(--text-light);
      border: 1px solid #444;
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
      transition: border-color 0.3s;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--primary-color);
    }

    button {
      width: 100%;
      padding: 0.75rem;
      background-color: var(--primary-color);
      color: var(--card-bg);
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
      margin-top: 0.5rem;
    }

    button:hover {
      background-color: #00a3cc;
      transform: translateY(-2px);
    }

    .ai-mode-toggle {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin: 1rem 0;
    }

    .ai-mode-btn {
      padding: 0.5rem 1rem;
      background: #333;
      border: none;
      border-radius: 8px;
      color: var(--text-light);
      cursor: pointer;
      font-weight: 500;
    }

    .ai-mode-btn.active {
      background: var(--primary-color);
      color: var(--card-bg);
    }

    .ai-online-hint {
      background: rgba(103, 58, 183, 0.1);
      border-right: 4px solid var(--ai-online-color);
      padding: 0.75rem;
      border-radius: 8px;
      margin: 1rem 0;
      font-size: 0.95rem;
      text-align: right;
      display: none;
    }

    .tasks-list {
      list-style: none;
      padding: 0;
    }

    .task-item {
      background: var(--item-bg);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 0.75rem;
      text-align: right;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-right: 4px solid var(--primary-color);
      transition: var(--transition);
    }

    .task-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    }

    .task-info strong {
      display: block;
      font-size: 1.1rem;
      margin-bottom: 0.2rem;
    }
    
    .task-info small {
        color: #aaa;
        display: block;
        margin-top: 0.3rem;
    }

    .task-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .task-actions button {
        width: auto;
        padding: 0.4rem 0.8rem;
        font-size: 0.9rem;
        background-color: #333;
        border-radius: 6px;
        transition: background-color 0.2s;
    }

    .task-actions .complete-btn { background-color: #4CAF50; }
    .task-actions .delete-btn { background-color: #f44336; }
    .task-actions .edit-btn { background-color: #2196F3; }

    .task-actions button:hover {
        opacity: 0.8;
    }

    .empty-state {
      color: #aaa;
      font-style: italic;
      margin-top: 2rem;
      text-align: center;
      padding: 1rem;
    }

    .ai-hint {
      background: rgba(156, 39, 176, 0.1);
      border-right: 4px solid var(--ai-color);
      padding: 0.75rem;
      border-radius: 8px;
      margin: 1rem 0;
      font-size: 0.95rem;
      text-align: right;
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      animation: fadeIn 0.5s ease-in;
    }
    
    .ai-hint i {
        color: var(--ai-color);
        font-size: 1.2rem;
        margin-top: 0.2rem;
    }

    .ai-advanced-hint {
      background: rgba(255, 87, 34, 0.1);
      border-right: 4px solid var(--ai-advanced-color);
      padding: 0.75rem;
      border-radius: 8px;
      margin: 1rem 0;
      font-size: 0.95rem;
      text-align: right;
      display: none;
    }

    .ai-advanced-hint button {
      background: var(--ai-advanced-color);
      color: white;
      padding: 0.3rem 0.6rem;
      border-radius: 4px;
      border: none;
      font-size: 0.9rem;
      cursor: pointer;
      margin-right: 0.5rem;
    }

    .search-input {
      width: 100%; 
      padding: 0.75rem; 
      border-radius: 8px; 
      border: 1px solid #444; 
      background: #2c2c3c;
      color: var(--text-light);
    }
    
    .stats-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
        gap: 1rem;
        margin-top: 1.5rem;
    }
    
    .stat-box {
        background: #333;
        padding: 1rem;
        border-radius: var(--radius);
        text-align: center;
        flex: 1 1 45%;
        min-width: 150px;
    }
    
    .stat-box h3 {
        margin-bottom: 0.5rem;
        font-size: 1rem;
        color: var(--primary-color);
    }
    
    .stat-box p {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--secondary-color);
    }

    .task-math { border-right-color: #f44336 !important; }
    .task-physics { border-right-color: #2196F3 !important; }
    .task-chemistry { border-right-color: #FFC107 !important; }
    .task-biology { border-right-color: #4CAF50 !important; }
    .task-literature { border-right-color: #9C27B0 !important; }
    .task-english { border-right-color: #00BCD4 !important; }
    .task-default { border-right-color: #9E9E9E !important; }

    /* راهنمای مطالعه */
    .guide-section {
      background: rgba(255, 255, 255, 0.05);
      padding: 1.5rem;
      border-radius: var(--radius);
      margin: 2rem 0;
      border: 1px solid rgba(0, 195, 255, 0.3);
      animation: slideUp 0.6s ease-out;
    }

    .guide-section h3 {
      color: var(--primary-color);
      margin-bottom: 1rem;
      font-size: 1.3rem;
    }

    .guide-section p {
      text-align: right;
      line-height: 1.8;
      margin-bottom: 0.8rem;
    }

    .guide-section ul {
      text-align: right;
      padding-right: 1.5rem;
      margin: 1rem 0;
    }

    .guide-section li {
      margin-bottom: 0.5rem;
      line-height: 1.6;
    }

    /* پنل والدین */
    .parent-panel {
      background: rgba(76, 175, 80, 0.1);
      border: 2px solid var(--parent-color);
      padding: 1.5rem;
      border-radius: var(--radius);
      margin: 2rem 0;
      display: none;
    }

    .parent-panel h3 {
      color: var(--parent-color);
      margin-bottom: 1rem;
      text-align: center;
    }

    .parent-report {
      background: #2c2c3c;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
    }

    .parent-report h4 {
      margin-bottom: 0.5rem;
      color: var(--parent-color);
    }

    /* تقویم هوشمند */
    .calendar-hint {
      background: rgba(255, 152, 0, 0.1);
      border-left: 4px solid #FF9800;
      padding: 0.75rem;
      border-radius: 8px;
      margin: 1rem 0;
      text-align: right;
      font-weight: 500;
    }

    /* هوش مصنوعی والدین */
    .parent-ai-summary {
      background: rgba(156, 39, 176, 0.15);
      border: 1px solid var(--ai-color);
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1rem;
    }

    /* بخش هوش مصنوعی پرسش و پاسخ */
    .ai-qa-section {
      margin: 2rem 0;
    }

    .ai-qa-section h3 {
      text-align: center;
      color: var(--ai-color);
      margin-bottom: 1rem;
    }

    /* بخش تست‌های شخصیت */
    .personality-test-section {
      margin: 2rem 0;
    }

    .personality-test-section h3 {
      text-align: center;
      color: var(--ai-color);
      margin-bottom: 1rem;
    }

    .test-question {
      margin-bottom: 1.5rem;
      text-align: right;
    }

    .test-options {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .test-option {
      padding: 0.5rem;
      background: #2c2c3c;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .test-option:hover {
      background: #3a3a4a;
    }

    .test-option.selected {
      background: var(--primary-color);
      color: var(--card-bg);
    }

    /* بخش بازخورد به مالک */
    .feedback-section {
      margin: 2rem 0;
    }

    .feedback-section h3 {
      text-align: center;
      color: var(--teacher-color);
      margin-bottom: 1rem;
    }

    /* انیمیشن‌ها */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { 
        opacity: 0;
        transform: translateY(20px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 600px) {
      body { padding: 1rem; font-size: 15px; }
      h1 { font-size: 1.5rem; }
      .card { padding: 1.2rem; }
      .guide-section { padding: 1rem; }
    }

    /* حالت کودکانه (کلاس اول تا ششم) */
    .child-mode {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .child-mode .card {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid #fff;
    }

    .child-mode button {
      background: #FF6B6B;
    }

    .child-mode button:hover {
      background: #FF5252;
    }

    /* لودینگ */
    .loading {
      display: inline-block;
      width: 1rem;
      height: 1rem;
      border: 2px solid #fff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>📚 برنامه‌ریزی هوشمند درسی</h1>

    <!-- تقویم هوشمند (شمسی) -->
    <div id="calendarHint" class="calendar-hint" style="display:none;"></div>

    <div class="card">
      <div class="form-group">
        <label for="fontSelect">🔤 انتخاب فونت:</label>
        <select id="fontSelect">
          <option value="'Vazirmatn', sans-serif">وزیر متن</option>
          <option value="'Shabnam', sans-serif">شبنم</option>
          <option value="'Samim', sans-serif">صمیم</option>
        </select>
      </div>

      <div class="form-group">
        <label for="fontSizeRange">🔠 اندازه متن:</label>
        <input type="range" id="fontSizeRange" min="14" max="22" value="16" />
        <span id="fontSizeValue">16px</span>
      </div>
    </div>

    <!-- بخش راهنمای مطالعه -->
    <div class="guide-section" id="studyGuide">
      <h3>💡 راهنمای مطالعه و موفقیت</h3>
      <p id="guideText">لطفاً پایه خود را انتخاب کنید تا راهنمای متناسب با شما نمایش داده شود.</p>
    </div>

    <!-- پنل والدین -->
    <div class="parent-panel" id="parentPanel">
      <h3>👨‍👩‍👧‍👦 پنل والدین</h3>
      <div class="form-group">
        <label for="parentPassword">رمز ورود والدین:</label>
        <input type="password" id="parentPassword" placeholder="رمز خانوادگی را وارد کنید" />
        <button id="parentLoginBtn" style="background-color: var(--parent-color); margin-top: 1rem;">ورود به پنل والدین</button>
      </div>
      
      <div id="parentReportSection" style="display:none;">
        <div class="parent-report">
          <h4>📊 گزارش هفتگی فعالیت‌ها</h4>
          <p>تعداد کل فعالیت‌ها: <span id="parentTotalTasks">0</span></p>
          <p>مجموع زمان مطالعه: <span id="parentTotalTime">0</span> دقیقه</p>
          <p>پایه تحصیلی: <span id="parentGrade">-</span></p>
        </div>
        
        <div class="parent-ai-summary">
          <h4>🤖 خلاصه هوش مصنوعی برای والدین</h4>
          <p id="parentAISummary">هنوز داده کافی برای تحلیل وجود ندارد.</p>
        </div>
        
        <button id="parentLogoutBtn" style="background-color: #f44336; margin-top: 1rem;">خروج از پنل والدین</button>
      </div>
    </div>

    <!-- بخش هوش مصنوعی پرسش و پاسخ -->
    <div class="card ai-qa-section">
      <h3><i class="fas fa-robot"></i> 🤖 هوش مصنوعی آموزشی</h3>
      
      <div class="ai-mode-toggle">
        <button class="ai-mode-btn active" data-mode="offline">🤖 هوش مصنوعی آفلاین</button>
        <button class="ai-mode-btn" data-mode="online">🌐 هوش مصنوعی آنلاین</button>
      </div>
      
      <div class="ai-online-hint">
        <p><strong>💡 هوش مصنوعی آنلاین فعال است:</strong></p>
        <p>- جستجوی وب برای یافتن پاسخ‌های دقیق‌تر</p>
        <p>- استفاده از مدل‌های قوی‌تر هوش مصنوعی</p>
        <p>- پاسخ‌های عمیق‌تر و جامع‌تر</p>
        <p style="font-size: 0.9rem; color: #aaa; margin-top: 0.5rem;">⚠️ نیاز به اتصال اینترنت دارد</p>
      </div>

      <div class="form-group">
        <label for="aiQuestion">سوال خود را درباره درس بپرسید:</label>
        <textarea id="aiQuestion" rows="3" placeholder="مثلاً: چرا در میتوز کروموزوم‌ها به استوای سلول می‌روند؟"></textarea>
      </div>
      <button id="askAIbtn">🧠 پرسش از هوش مصنوعی</button>
      <div id="aiAnswer" class="ai-hint" style="display:none; margin-top:1rem; justify-content:flex-start; flex-direction:column; align-items:flex-start;">
        <div id="aiMainAnswer"></div>
        <div id="aiAdvancedHint" class="ai-advanced-hint">
          <p><strong>💡 اطلاعات بیشتر برای درک عمیق‌تر (خارج از کتاب درسی):</strong></p>
          <div id="aiAdvancedContent"></div>
          <button id="hideAdvancedBtn">منصرف شدم</button>
        </div>
      </div>
    </div>

    <!-- بخش تست‌های شخصیت -->
    <div class="card personality-test-section">
      <h3><i class="fas fa-brain"></i> 🧠 تست شخصیت و مشاوره</h3>
      <button id="startPersonalityTest">شروع تست شخصیت</button>
      <div id="testContainer" style="display:none; margin-top:1rem;">
        <div id="testQuestion" class="test-question"></div>
        <div id="testOptions" class="test-options"></div>
        <button id="nextQuestion" style="margin-top:1rem; display:none;">سوال بعدی</button>
        <button id="finishTest" style="margin-top:1rem; display:none;">پایان تست</button>
      </div>
      <div id="testResult" class="ai-hint" style="display:none; margin-top:1rem; justify-content:flex-start; flex-direction:column; align-items:flex-start;"></div>
    </div>

    <!-- بخش بازخورد به مالک -->
    <div class="card feedback-section">
      <h3><i class="fas fa-comment"></i> 📩 ارتباط با مالک</h3>
      <div class="form-group">
        <label for="feedbackType">نوع بازخورد:</label>
        <select id="feedbackType">
          <option value="bug">گزارش باگ</option>
          <option value="suggestion">پیشنهاد</option>
          <option value="praise">تقدیر</option>
          <option value="other">سایر</option>
        </select>
      </div>
      <div class="form-group">
        <label for="feedbackMessage">پیام شما:</label>
        <textarea id="feedbackMessage" rows="4" placeholder="پیام خود را اینجا بنویسید..."></textarea>
      </div>
      <button id="sendFeedback">ارسال بازخورد</button>
      <div id="feedbackStatus" style="margin-top:1rem; text-align:center; color:var(--primary-color);"></div>
    </div>

    <div class="card" id="mainFormCard">
      <div class="form-group">
        <label for="gradeSelect">🎓 پایه تحصیلی:</label>
        <select id="gradeSelect">
          <option value="">انتخاب کنید...</option>
          <option value="اول ابتدایی">اول ابتدایی</option>
          <option value="دوم ابتدایی">دوم ابتدایی</option>
          <option value="سوم ابتدایی">سوم ابتدایی</option>
          <option value="چهارم ابتدایی">چهارم ابتدایی</option>
          <option value="پنجم ابتدایی">پنجم ابتدایی</option>
          <option value="ششم ابتدایی">ششم ابتدایی</option>
          <option value="هفتم">هفتم</option>
          <option value="هشتم">هشتم</option>
          <option value="نهم">نهم</option>
          <option value="دهم">دهم</option>
          <option value="یازدهم">یازدهم</option>
          <option value="دوازدهم">دوازدهم</option>
          <option value="فارغ‌التحصیل">فارغ‌التحصیل / دانشجو</option>
        </select>
      </div>

      <!-- فیلد رشته (فقط برای دهم تا دوازدهم) -->
      <div class="form-group" id="fieldGroup" style="display:none;">
        <label for="fieldSelect">🔬 رشته تحصیلی:</label>
        <select id="fieldSelect">
          <option value="">انتخاب رشته...</option>
          <option value="ریاضی">ریاضی و فیزیک</option>
          <option value="تجربی">علوم تجربی</option>
          <option value="انسانی">علوم انسانی</option>
        </select>
      </div>

      <div class="form-group">
        <label for="subjectSelect">📚 درس مرتبط:</label>
        <select id="subjectSelect" disabled>
          <option value="">ابتدا پایه و رشته را انتخاب کنید</option>
        </select>
      </div>

      <div class="form-group" id="customSubjectGroup" style="display:none;">
        <label for="customSubjectInput">📝 نام درس جدید:</label>
        <input type="text" id="customSubjectInput" placeholder="مثلاً: هنر، کدنویسی، قرآن..." />
      </div>

      <div class="form-group">
        <label for="taskInput">📌 عنوان فعالیت:</label>
        <input type="text" id="taskInput" placeholder="مثلاً: مطالعه فصل ۳ ریاضی" />
      </div>

      <div class="form-group">
        <label for="timeInput">⏱ زمان تخمینی (دقیقه):</label>
        <input type="number" id="timeInput" min="5" step="5" placeholder="مثلاً: 30" />
      </div>

      <button id="addTaskBtn">➕ افزودن فعالیت</button>
    </div>

    <div class="card">
      <input type="text" id="searchInput" placeholder="🔍 جستجوی فعالیت یا درس..." class="search-input" />
      <div id="statsSection" class="stats-container" style="display:none;">
          <div class="stat-box">
              <h3>فعالیت‌ها</h3>
              <p id="totalTasksCount">0</p>
          </div>
          <div class="stat-box">
              <h3>کل زمان</h3>
              <p id="totalStudyTime">0 دقیقه</p>
          </div>
      </div>
    </div>
    
    <div id="aiHintBox" class="ai-hint" style="display:none;">
      <i class="fas fa-robot"></i>
      <span id="aiHintText">پیشنهاد هوشمند: ...</span>
    </div>

    <h2>📋 فعالیت‌های برنامه‌ریزی شده</h2>
    <ul id="tasksList" class="tasks-list"></ul>
    <p id="emptyState" class="empty-state">هنوز هیچ فعالیتی اضافه نشده است.</p>
  </div>

  <script>
    // Persian Date Converter (Shamsi Calendar)
    function toPersianDate(date) {
      const gregorianDate = new Date(date);
      const year = gregorianDate.getFullYear();
      const month = gregorianDate.getMonth() + 1;
      const day = gregorianDate.getDate();
      
      // Simple conversion (for demo purposes)
      // In production, use a library like 'persian-date'
      const persianMonths = [
        'فروردین', 'اردیبهشت', 'خرداد',
        'تیر', 'مرداد', 'شهریور',
        'مهر', 'آبان', 'آذر',
        'دی', 'بهمن', 'اسفند'
      ];
      
      // Approximate conversion
      let persianYear = year - 621;
      let persianMonth = month - 3;
      let persianDay = day;
      
      if (persianMonth <= 0) {
        persianMonth += 12;
        persianYear -= 1;
      }
      
      if (persianDay > 31 && persianMonth > 6) {
        persianDay -= 30;
      }
      
      return `${persianYear}/${persianMonth}/${persianDay}`;
    }

    document.addEventListener('DOMContentLoaded', function() {
      // Performance optimization: Cache DOM elements
      const elements = {
        taskInput: document.getElementById('taskInput'),
        subjectSelect: document.getElementById('subjectSelect'),
        customSubjectGroup: document.getElementById('customSubjectGroup'),
        customSubjectInput: document.getElementById('customSubjectInput'),
        timeInput: document.getElementById('timeInput'),
        addTaskBtn: document.getElementById('addTaskBtn'),
        tasksList: document.getElementById('tasksList'),
        emptyState: document.getElementById('emptyState'),
        fontSelect: document.getElementById('fontSelect'),
        fontSizeRange: document.getElementById('fontSizeRange'),
        fontSizeValue: document.getElementById('fontSizeValue'),
        searchInput: document.getElementById('searchInput'),
        gradeSelect: document.getElementById('gradeSelect'),
        fieldSelect: document.getElementById('fieldSelect'),
        fieldGroup: document.getElementById('fieldGroup'),
        aiHintBox: document.getElementById('aiHintBox'),
        aiHintText: document.getElementById('aiHintText'),
        statsSection: document.getElementById('statsSection'),
        totalTasksCount: document.getElementById('totalTasksCount'),
        totalStudyTime: document.getElementById('totalStudyTime'),
        studyGuide: document.getElementById('studyGuide'),
        guideText: document.getElementById('guideText'),
        calendarHint: document.getElementById('calendarHint'),
        parentPanel: document.getElementById('parentPanel'),
        parentPassword: document.getElementById('parentPassword'),
        parentLoginBtn: document.getElementById('parentLoginBtn'),
        parentLogoutBtn: document.getElementById('parentLogoutBtn'),
        parentReportSection: document.getElementById('parentReportSection'),
        parentTotalTasks: document.getElementById('parentTotalTasks'),
        parentTotalTime: document.getElementById('parentTotalTime'),
        parentGrade: document.getElementById('parentGrade'),
        parentAISummary: document.getElementById('parentAISummary'),
        mainFormCard: document.getElementById('mainFormCard'),
        aiQuestion: document.getElementById('aiQuestion'),
        askAIbtn: document.getElementById('askAIbtn'),
        aiAnswer: document.getElementById('aiAnswer'),
        aiMainAnswer: document.getElementById('aiMainAnswer'),
        aiAdvancedHint: document.getElementById('aiAdvancedHint'),
        aiAdvancedContent: document.getElementById('aiAdvancedContent'),
        hideAdvancedBtn: document.getElementById('hideAdvancedBtn'),
        startPersonalityTest: document.getElementById('startPersonalityTest'),
        testContainer: document.getElementById('testContainer'),
        testQuestion: document.getElementById('testQuestion'),
        testOptions: document.getElementById('testOptions'),
        nextQuestion: document.getElementById('nextQuestion'),
        finishTest: document.getElementById('finishTest'),
        testResult: document.getElementById('testResult'),
        feedbackType: document.getElementById('feedbackType'),
        feedbackMessage: document.getElementById('feedbackMessage'),
        sendFeedback: document.getElementById('sendFeedback'),
        feedbackStatus: document.getElementById('feedbackStatus')
      };

      // State management
      let state = {
        tasks: JSON.parse(localStorage.getItem('studyTasks')) || [],
        editingIndex: -1,
        isParentMode: false,
        PARENT_PASSWORD: "123456",
        aiMode: 'offline',
        userProfile: JSON.parse(localStorage.getItem('userProfile')) || {
          name: '',
          gender: 'neutral',
          preferredStudyTime: 'evening',
          studyPattern: [],
          motivationLevel: 0,
          lastInteraction: new Date().toISOString(),
          personality: null
        }
      };

      // Subjects by grade and field
      const subjectsByGrade = {
        'اول ابتدایی': ['فارسی', 'ریاضی', 'علوم', 'هدیه‌های آسمان', 'اجتماعی', 'ورزش', 'هنر'],
        'دوم ابتدایی': ['فارسی', 'ریاضی', 'علوم', 'هدیه‌های آسمان', 'اجتماعی', 'ورزش', 'هنر', 'خوانداری'],
        'سوم ابتدایی': ['فارسی', 'ریاضی', 'علوم', 'هدیه‌های آسمان', 'اجتماعی', 'ورزش', 'هنر', 'تعلیمات اجتماعی', 'خوانداری'],
        'چهارم ابتدایی': ['فارسی', 'ریاضی', 'علوم', 'هدیه‌های آسمان', 'اجتماعی', 'ورزش', 'هنر', 'تعلیمات اجتماعی', 'کار و فناوری', 'خوانداری'],
        'پنجم ابتدایی': ['فارسی', 'ریاضی', 'علوم', 'هدیه‌های آسمان', 'اجتماعی', 'ورزش', 'هنر', 'تعلیمات اجتماعی', 'کار و فناوری', 'زبان انگلیسی', 'خوانداری'],
        'ششم ابتدایی': ['فارسی', 'ریاضی', 'علوم', 'هدیه‌های آسمان', 'اجتماعی', 'ورزش', 'هنر', 'تعلیمات اجتماعی', 'کار و فناوری', 'زبان انگلیسی'],
        'هفتم': ['فارسی', 'ریاضی', 'علوم', 'مطالعات اجتماعی', 'عربی', 'قرآن', 'پیام‌های آسمان', 'نگارش', 'زبان انگلیسی', 'کار و فناوری', 'هنر', 'ورزش'],
        'هشتم': ['فارسی', 'ریاضی', 'علوم', 'مطالعات اجتماعی', 'عربی', 'قرآن', 'پیام‌های آسمان', 'نگارش', 'زبان انگلیسی', 'کار و فناوری', 'هنر', 'ورزش'],
        'نهم': ['فارسی', 'ریاضی', 'علوم', 'مطالعات اجتماعی', 'عربی', 'قرآن', 'پیام‌های آسمان', 'نگارش', 'زبان انگلیسی', 'کار و فناوری', 'هنر', 'ورزش'],
        'دهم': {
          'ریاضی': ['ریاضی', 'فیزیک', 'شیمی', 'زیست', 'فارسی', 'عربی', 'زبان انگلیسی', 'تفکر و سواد رسانه‌ای', 'نگارش', 'آمادگی دفاعی', 'هنر', 'ورزش'],
          'تجربی': ['ریاضی', 'فیزیک', 'شیمی', 'زیست', 'فارسی', 'عربی', 'زبان انگلیسی', 'تفکر و سواد رسانه‌ای', 'نگارش', 'آمادگی دفاعی', 'هنر', 'ورزش'],
          'انسانی': ['ریاضی', 'جغرافیا', 'اقتصاد', 'تاریخ', 'فارسی', 'عربی', 'زبان انگلیسی', 'تفکر و سواد رسانه‌ای', 'نگارش', 'آمادگی دفاعی', 'هنر', 'ورزش']
        },
        'یازدهم': {
          'ریاضی': ['ریاضی', 'فیزیک', 'شیمی', 'فارسی', 'عربی', 'زبان انگلیسی', 'تفکر و سواد رسانه‌ای', 'آمادگی دفاعی', 'هنر', 'ورزش'],
          'تجربی': ['ریاضی', 'فیزیک', 'شیمی', 'زیست', 'فارسی', 'عربی', 'زبان انگلیسی', 'تفکر و سواد رسانه‌ای', 'آمادگی دفاعی', 'هنر', 'ورزش'],
          'انسانی': ['ریاضی', 'جغرافیا', 'اقتصاد', 'تاریخ', 'فارسی', 'عربی', 'زبان انگلیسی', 'تفکر و سواد رسانه‌ای', 'آمادگی دفاعی', 'هنر', 'ورزش']
        },
        'دوازدهم': {
          'ریاضی': ['ریاضی', 'فیزیک', 'شیمی', 'فارسی', 'عربی', 'زبان انگلیسی', 'تفکر و سواد رسانه‌ای', 'آمادگی دفاعی', 'هنر', 'ورزش'],
          'تجربی': ['ریاضی', 'فیزیک', 'شیمی', 'زیست', 'فارسی', 'عربی', 'زبان انگلیسی', 'تفکر و سواد رسانه‌ای', 'آمادگی دفاعی', 'هنر', 'ورزش'],
          'انسانی': ['ریاضی', 'جغرافیا', 'اقتصاد', 'تاریخ', 'فارسی', 'عربی', 'زبان انگلیسی', 'تفکر و سواد رسانه‌ای', 'آمادگی دفاعی', 'هنر', 'ورزش']
        },
        'فارغ‌التحصیل': ['زبان انگلیسی', 'ریاضی', 'برنامه‌نویسی', 'مدیریت زمان', 'مطالعات عمومی', 'مهارت‌های زندگی', 'ورزش', 'هنر']
      };

      // Study guides by grade
      const studyGuides = {
        'اول ابتدایی': `🌟 <strong>راهنمای مطالعه برای کلاس اول:</strong><br>
        - روزانه حداکثر ۳۰ دقیقه مطالعه کنید.<br>
        - از بازی‌های آموزشی برای یادگیری استفاده کنید.<br>
        - هر روز کمی از کتاب فارسی و ریاضی را مرور کنید.<br>
        - برای کودکان این سن، یادگیری باید شاد و بازی‌گونه باشد!`,
        'دوم ابتدایی': `🌈 <strong>راهنمای مطالعه برای کلاس دوم:</strong><br>
        - روزانه ۴۰ دقیقه مطالعه مفید داشته باشید.<br>
        - از روش‌های تصویری و داستانی برای یادگیری استفاده کنید.<br>
        - تمرین خواندن را روزانه انجام دهید.<br>
        - مفاهیم پایه ریاضی را با اشیاء واقعی یاد بگیرید.`,
        'سوم ابتدایی': `📚 <strong>راهنمای مطالعه برای کلاس سوم:</strong><br>
        - روزانه ۴۵-۶۰ دقیقه مطالعه داشته باشید.<br>
        - شروع به یادداشت‌برداری ساده کنید.<br>
        - مفاهیم ریاضی را با مثال‌های عملی یاد بگیرید.<br>
        - خواندن کتاب‌های داستانی را به عادت تبدیل کنید.`,
        'چهارم ابتدایی': `🎯 <strong>راهنمای مطالعه برای کلاس چهارم:</strong><br>
        - روزانه ۱-۱.۵ ساعت مطالعه داشته باشید.<br>
        - شروع به برنامه‌ریزی هفتگی کنید.<br>
        - مباحث علوم را با آزمایش‌های ساده درک کنید.<br>
        - تمرین نوشتن پاراگراف‌های کوتاه را آغاز کنید.`,
        'پنجم ابتدایی': `🚀 <strong>راهنمای مطالعه برای کلاس پنجم:</strong><br>
        - روزانه ۱.۵-۲ ساعت مطالعه داشته باشید.<br>
        - شروع به خلاصه‌نویسی از درس‌ها کنید.<br>
        - مفاهیم ریاضی پیچیده‌تر را با حل مسئله یاد بگیرید.<br>
        - زبان انگلیسی را با کارت‌های یادگیری تقویت کنید.`,
        'ششم ابتدایی': `🎓 <strong>راهنمای مطالعه برای کلاس ششم:</strong><br>
        - روزانه ۲-۲.۵ ساعت مطالعه داشته باشید.<br>
        - شروع به تست‌زنی ساده کنید.<br>
        - برای ورود به متوسطه اول، مباحث پایه را تقویت کنید.<br>
        - برنامه‌ریزی منظم هفتگی داشته باشید.`,
        'هفتم': `📖 <strong>راهنمای مطالعه برای کلاس هفتم:</strong><br>
        - روزانه ۲.۵-۳ ساعت مطالعه داشته باشید.<br>
        - یادگیری دروس جدید مانند عربی و پیام‌های آسمان را جدی بگیرید.<br>
        - از روش‌های یادگیری فعال مانند فلش‌کارت استفاده کنید.<br>
        - شروع به سازماندهی جزوه‌ها و کتاب‌ها کنید.`,
        'هشتم': `🔬 <strong>راهنمای مطالعه برای کلاس هشتم:</strong><br>
        - روزانه ۳-۳.۵ ساعت مطالعه داشته باشید.<br>
        - شروع به مرور منظم درس‌های قبلی کنید.<br>
        - برای دروس علوم و ریاضی از حل مسئله بیشتر استفاده کنید.<br>
        - مهارت‌های ارتباطی و اجتماعی را تقویت کنید.`,
        'نهم': `🚀 <strong>راهنمای مطالعه برای کلاس نهم:</strong><br>
        - این سال پایه‌ای برای انتخاب رشته است!<br>
        - روزانه ۳.۵-۴ ساعت مطالعه داشته باشید.<br>
        - تست‌زنی جدی را شروع کنید.<br>
        - با توجه به علاقه و استعداد خود، رشته آینده را بررسی کنید.`,
        'دهم': `📚 <strong>راهنمای مطالعه برای کلاس دهم:</strong><br>
        - این سال شروع جدی مسیر کنکور است!<br>
        - روزانه ۴-۵ ساعت مطالعه مفید داشته باشید.<br>
        - مباحث پایه را کامل یاد بگیرید — سال آینده وقت تکرار نخواهید داشت.<br>
        - برنامه‌ریزی دقیق و منظم داشته باشید.`,
        'دوازدهم': `🔥 <strong>راهنمای مطالعه برای کلاس دوازدهم:</strong><br>
        - این سال حساس‌ترین سال تحصیلی شماست!<br>
        - روزانه ۵-۷ ساعت مطالعه مفید داشته باشید.<br>
        - تست‌زنی و دوره کامل را شروع کنید.<br>
        - استرس را مدیریت کنید و سلامت روان خود را حفظ کنید.`,
        'فارغ‌التحصیل': `🎓 <strong>راهنمای مطالعه برای دانشجویان و فارغ‌التحصیلان:</strong><br>
        - مطالعه را هدفمند و مبتنی بر نیاز انجام دهید.<br>
        - از تکنیک‌های پومودورو و برنامه‌ریزی بلندمدت استفاده کنید.<br>
        - مهارت‌های نرم (Soft Skills) را فراموش نکنید.<br>
        - یادگیری مادام‌العمر را در برنامه خود بگنجانید.`
      };

      const defaultGuide = `💡 <strong>راهنمای عمومی مطالعه:</strong><br>
      - برنامه‌ریزی منظم و واقع‌بینانه داشته باشید.<br>
      - هر ۴۵ دقیقه ۱۰ دقیقه استراحت کنید.<br>
      - محیط مطالعه خود را مرتب و بدون حواس‌پرتی نگه دارید.<br>
      - هدف‌گذاری کوتاه‌مدت و بلندمدت داشته باشید.`;

      // Iranian holidays (Shamsi dates)
      const iranianEvents = {
        '1404-01-01': '📅 شروع نوروز — تعطیلات بهاری',
        '1404-01-02': '📅 عید نوروز',
        '1404-01-03': '📅 عید نوروز',
        '1404-01-13': '📅 سیزده بدر — پایان تعطیلات نوروز',
        '1404-04-01': '📅 شروع امتحانات نهایی',
        '1404-04-15': '📅 پایان امتحانات نهایی',
        '1404-05-20': '📅 شروع سال تحصیلی جدید',
        '1404-09-30': '📅 شروع تعطیلات زمستانی',
        '1404-10-15': '📅 پایان تعطیلات زمستانی'
      };

      // Educational content database (embedded in code)
      const educationalContent = {
        'زیست دهم': {
          'میتوز': 'در کتاب زیست‌شناسی دهم، فصل 3، میتوز به عنوان نوعی تقسیم سلولی تعریف شده که در آن یک سلول به دو سلول دختر یکسان تقسیم می‌شود. در مرحله متافاز، کروموزوم‌ها در استوای سلول قرار می‌گیرند تا تقسیم آن‌ها به دو سلول دختر دقیق‌تر انجام شود.',
          'کروموزوم': 'کروموزوم‌ها ساختارهایی از DNA و پروتئین هستند که اطلاعات ژنتیکی را حمل می‌کنند. در سلول‌های یوکاریوتی، کروموزوم‌ها در هسته قرار دارند.'
        },
        'زیست یازدهم': {
          'میتوز': 'در کتاب زیست‌شناسی یازدهم، میتوز به عنوان فرآیندی برای رشد و ترمیم بافت‌ها معرفی شده است. در مرحله متافاز، رشته‌های دوک به سانترومر کروموزوم‌ها متصل شده و آن‌ها را به استوای سلول می‌کشند.',
          'سانترومر': 'سانترومر ناحیه‌ای از کروموزوم است که رشته‌های دوک به آن متصل می‌شوند. این ناحیه نقش مهمی در حرکت کروموزوم‌ها در طول تقسیم سلولی دارد.'
        },
        'زیست دوازدهم': {
          'میتوز': 'در کتاب زیست‌شناسی دوازدهم، میتوز در رابطه با چرخه سلولی و کنترل آن مورد بررسی قرار می‌گیرد. تنظیم دقیق مراحل میتوز برای جلوگیری از بیماری‌هایی مانند سرطان ضروری است.',
 
